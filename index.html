<canvas id="canvas" width="640" height="480" style="border: 1px solid #505050"></canvas>
<script>
var canvas = document.getElementById("canvas");
var context = canvas.getContext("2d");

// global variables
var fps = 30;
var width = canvas.width;
var height = canvas.height;
var right = 100;
var bottom = height/width*100;
var backColor = "#000000";
var foreColor = "#505050";
var playerColor = "#ffd700";


function randomInt(max) {
    return Math.floor(Math.random() * max);
}


class Figure {
    constructor(form) {
        // numbers in (this.form, this.x, this.y)
        // should be from 0 to 100
        // if width=640: 100 will be interpreted as 640
        // 50 as 640/2... so it's % of width (both y and x are % of width)
        this.form = form;  // array of points (array of array of two numbers)
        this.x = 0;
        this.y = 0;
        this.rotation = 0;  // radians
    }

    adaptSize(a, is_height) {
        if (is_height) {
            return (height*a/100) * (width/height);
        }
        return width*a/100;
    }

    calculatedPoint(point) {
        let cos = Math.cos;
        let sin = Math.sin;
        let x = width*point[0]/100;
        let y = height*point[1]/100;
        let new_x = cos(this.rotation)*x - sin(this.rotation)*y;
        let new_y = sin(this.rotation)*x + cos(this.rotation)*y;
        return [new_x, new_y];
    }

    draw() {
        let self = this;
        let x = this.adaptSize(this.x, false);
        let y = this.adaptSize(this.y, true)
        let points = this.form.map(point => {return self.calculatedPoint(point);})
        context.strokeStyle = playerColor;
        context.lineWidth = 1;

        context.beginPath();
        context.moveTo(x+points[0][0], y+points[0][1]);
        for (const point of points) {
            context.lineTo(x+point[0], y+point[1])
        }
        context.lineTo(x+points[0][0], y+points[0][1]);
        context.stroke();
    }

}

class Player extends Figure {
    constructor() {
        super([[0, -4], [-2, 4], [0, 2], [2, 4]]);
        this.x = right/2;
        this.y = bottom/2;
    }
}

class Asteroid extends Figure {
    constructor() {
        super([[0, -4], [-2, 4], [0, 2], [2, 4]]);
        let spawn = randomInt(4)
        if (spawn == 0) {
            this.x = -10;
            this.y = randomInt(bottom+1);
        } else if (spawn == 1) {
            this.x = right+10;
            this.y = randomInt(bottom+1);
        } else if (spawn == 2) {
            this.x = randomInt(right+1);
            this.y = bottom+10;
        } else {
            this.x = randomInt(right+1);
            this.y = -10;
        }
        this.rotation = Math.random() * Math.PI;
        this.vx = 0.1;
        this.vy = 0.1;
        this.vr = 0.1;
    }

    update() {
        this.x += this.vx;
        if (this.x > right && this.vx > 0 || this.x < 0 && this.vs < 0) {
            this.vx *= -1;
        }
        this.y += this.vy;
        if (this.y > bottom && this.vy > 0 || this.y < 0 && this.vy < 0) {
            this.vy *= -1;
        }
        this.rotation += this.vr;
        if (this.rotation > Math.PI*2) {
            this.rotation -= Math.PI*2
        }
        if (this.rotation < -Math.PI*2) {
            this.rotation += Math.PI*2
        }
    }

}

class Game {
    constructor() {
        this.player = new Player();
        this.asteroids = [];
        for (let i=0; i<10; i++) {
            this.asteroids.push(new Asteroid());
        }
    }

    clear() {
        context.fillStyle = backColor;
        context.fillRect(0, 0, width, height);
    }

    cycle() {
        this.clear();
        if (this.player.x > right) {
            this.player.x = 0;
        }
        if (this.player.rotation > Math.PI*2) {
            this.player.rotation = 0;
        }
        this.player.x += 0.1;
        this.player.rotation += 0.01;
        this.player.draw();
        for (const asteroid of this.asteroids) {
            asteroid.update();
            asteroid.draw();
        }
    }
}


function main() {
    let game = new Game();
    setInterval(() => {game.cycle();}, 1000/fps);
}

main();
</script>
